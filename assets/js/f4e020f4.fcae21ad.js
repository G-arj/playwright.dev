"use strict";(self.webpackChunkplaywright_dev=self.webpackChunkplaywright_dev||[]).push([[1562],{23669:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return p},contentTitle:function(){return d},metadata:function(){return u},toc:function(){return c},default:function(){return k}});var s=a(87462),n=a(63366),r=(a(67294),a(3905)),l=a(26396),i=a(58215),o=["components"],p={id:"test-parallel",title:"Parallelism and sharding"},d=void 0,u={unversionedId:"test-parallel",id:"version-1.14/test-parallel",isDocsHomePage:!1,title:"Parallelism and sharding",description:"Playwright Test runs tests in parallel. In order to achieve that, it runs several worker processes that run at the same time.",source:"@site/versioned_docs/version-1.14/test-parallel.mdx",sourceDirName:".",slug:"/test-parallel",permalink:"/docs/1.14/test-parallel",tags:[],version:"1.14",frontMatter:{id:"test-parallel",title:"Parallelism and sharding"},sidebar:"version-1.14/docs",previous:{title:"Page Object Model",permalink:"/docs/1.14/test-pom"},next:{title:"Reporters",permalink:"/docs/1.14/test-reporters"}},c=[{value:"Worker processes",id:"worker-processes",children:[],level:2},{value:"Limit workers",id:"limit-workers",children:[],level:2},{value:"Disable parallelism",id:"disable-parallelism",children:[],level:2},{value:"Failed tests, retries and serial mode",id:"failed-tests-retries-and-serial-mode",children:[{value:"Serial mode",id:"serial-mode",children:[],level:3},{value:"Reusing single page between tests",id:"reusing-single-page-between-tests",children:[],level:3}],level:2},{value:"Shard tests between multiple machines",id:"shard-tests-between-multiple-machines",children:[],level:2},{value:"Limit failures and fail fast",id:"limit-failures-and-fail-fast",children:[],level:2},{value:"Worker index",id:"worker-index",children:[],level:2}],m={toc:c};function k(e){var t=e.components,a=(0,n.Z)(e,o);return(0,r.kt)("wrapper",(0,s.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Playwright Test runs tests in parallel. In order to achieve that, it runs several worker processes that run at the same time."),(0,r.kt)("p",null,"By default, test files are run in parallel. Tests in a single file are run in order, in the same worker process. You can control the number of ",(0,r.kt)("a",{parentName:"p",href:"#limit-workers"},"parallel worker processes")," or ",(0,r.kt)("a",{parentName:"p",href:"#disable-parallelism"},"disable parallelism")," altogether."),(0,r.kt)("p",null,"You can ",(0,r.kt)("a",{parentName:"p",href:"#limit-failures-and-fail-fast"},"limit the number of failures"),' in the whole test suite to avoid wasting resources and "fail fast".'),(0,r.kt)("h2",{id:"worker-processes"},"Worker processes"),(0,r.kt)("p",null,"All tests run in worker processes. These processes are OS processes, running independently, orchestrated by the test runner. All workers have identical environments and each starts its own browser."),(0,r.kt)("p",null,"You can't communicate between the workers. Playwright Test reuses a single worker as much as it can to make testing faster, so multiple test files are usually run in a single worker one after another."),(0,r.kt)("h2",{id:"limit-workers"},"Limit workers"),(0,r.kt)("p",null,"You can control the maximum number of parallel worker processes via ",(0,r.kt)("a",{parentName:"p",href:"/docs/1.14/test-cli"},"command line")," or in the ",(0,r.kt)("a",{parentName:"p",href:"/docs/1.14/test-configuration"},"configuration file"),"."),(0,r.kt)("p",null,"From the command line:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npx playwright test --workers 4\n")),(0,r.kt)("p",null,"In the configuration file:"),(0,r.kt)(l.Z,{groupId:"js-flavor",defaultValue:"ts",values:[{label:"TypeScript",value:"ts"},{label:"JavaScript",value:"js"}],mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"ts",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// playwright.config.ts\nimport { PlaywrightTestConfig } from '@playwright/test';\n\nconst config: PlaywrightTestConfig = {\n  // Limit the number of workers on CI, use default locally\n  workers: process.env.CI ? 2 : undefined,\n};\nexport default config;\n"))),(0,r.kt)(i.Z,{value:"js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// playwright.config.js\n// @ts-check\n\n/** @type {import('@playwright/test').PlaywrightTestConfig} */\nconst config = {\n  // Limit the number of workers on CI, use default locally\n  workers: process.env.CI ? 2 : undefined,\n};\n\nmodule.exports = config;\n")))),(0,r.kt)("h2",{id:"disable-parallelism"},"Disable parallelism"),(0,r.kt)("p",null,"You can disable any parallelism by allowing just a single worker at any time. Either set ",(0,r.kt)("inlineCode",{parentName:"p"},"workers: 1")," option in the configuration file or pass ",(0,r.kt)("inlineCode",{parentName:"p"},"--workers=1")," to the command line."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npx playwright test --workers=1\n")),(0,r.kt)("h2",{id:"failed-tests-retries-and-serial-mode"},"Failed tests, retries and serial mode"),(0,r.kt)("p",null,"Should any test fail, Playwright Test will discard entire worker process along with the browsers used and will start a new one. Testing will continue in the new worker process, starting with retrying the failed test, or from the next test if retries are disabled."),(0,r.kt)("p",null,"This scheme works perfectly for independent tests and guarantees that failing tests can't affect healthy ones. Consider the following snippet:"),(0,r.kt)(l.Z,{groupId:"js-flavor",defaultValue:"ts",values:[{label:"TypeScript",value:"ts"},{label:"JavaScript",value:"js"}],mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"ts",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { test } from '@playwright/test';\n\ntest.describe('suite', () => {\n  test('first good', async ({ page }) => { /* ... */ });\n  test('second flaky', async ({ page }) => { /* ... */ });\n  test('third good', async ({ page }) => { /* ... */ });\n});\n"))),(0,r.kt)(i.Z,{value:"js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const { test } = require('@playwright/test');\n\ntest.describe('suite', () => {\n  test('first good', async ({ page }) => { /* ... */ });\n  test('second flaky', async ({ page }) => { /* ... */ });\n  test('third good', async ({ page }) => { /* ... */ });\n});\n")))),(0,r.kt)("p",null,"Tests will run in the following way:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Worker process #1:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"first good")," passes"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"second flaky")," fails"))),(0,r.kt)("li",{parentName:"ul"},"Worker process #2:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"If ",(0,r.kt)("a",{parentName:"li",href:"/docs/1.14/test-retries"},"retries")," are enabled, ",(0,r.kt)("inlineCode",{parentName:"li"},"second flaky")," is retried and passes"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"third good")," passes")))),(0,r.kt)("h3",{id:"serial-mode"},"Serial mode"),(0,r.kt)("p",null,"Use ",(0,r.kt)("a",{parentName:"p",href:"/docs/1.14/api/class-test#test-describe-serial"},"test.describe.serial(title, callback)")," to group dependent tests to ensure they will always run together and in order. If one of the tests fails, all subsequent tests are skipped. All tests in the group are retried together."),(0,r.kt)("p",null,"This is useful for dependent tests that cannot be run in isolation. For example, restarting after the failure from the second test might not work."),(0,r.kt)("p",null,"Consider the following snippet that uses ",(0,r.kt)("inlineCode",{parentName:"p"},"test.describe.serial"),":"),(0,r.kt)(l.Z,{groupId:"js-flavor",defaultValue:"ts",values:[{label:"TypeScript",value:"ts"},{label:"JavaScript",value:"js"}],mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"ts",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"import { test } from '@playwright/test';\n\ntest.describe.serial('suite', () => {\n  test('first good', async ({ page }) => { /* ... */ });\n  test('second flaky', async ({ page }) => { /* ... */ });\n  test('third good', async ({ page }) => { /* ... */ });\n});\n"))),(0,r.kt)(i.Z,{value:"js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const { test } = require('@playwright/test');\n\ntest.describe.serial('suite', () => {\n  test('first good', async ({ page }) => { /* ... */ });\n  test('second flaky', async ({ page }) => { /* ... */ });\n  test('third good', async ({ page }) => { /* ... */ });\n});\n")))),(0,r.kt)("p",null,"When running without ",(0,r.kt)("a",{parentName:"p",href:"/docs/1.14/test-retries"},"retries"),", all tests after the failure are skipped:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Worker process #1:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"first good")," passes"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"second flaky")," fails"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"third good")," is skipped entirely")))),(0,r.kt)("p",null,"When running with ",(0,r.kt)("a",{parentName:"p",href:"/docs/1.14/test-retries"},"retries"),", all tests are retried together:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Worker process #1:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"first good")," passes"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"second flaky")," fails"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"third good")," is skipped"))),(0,r.kt)("li",{parentName:"ul"},"Worker process #2:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"first good")," passes again"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"second flaky")," passes"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"third good")," passes")))),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"It is usually better to make your tests isolated, so they can be efficiently run and retried independently."))),(0,r.kt)("h3",{id:"reusing-single-page-between-tests"},"Reusing single page between tests"),(0,r.kt)("p",null,"Playwright Test creates an isolated ",(0,r.kt)("a",{parentName:"p",href:"/docs/1.14/api/class-page",title:"Page"},"Page")," object for each test. However, if you'd like to reuse a single ",(0,r.kt)("a",{parentName:"p",href:"/docs/1.14/api/class-page",title:"Page"},"Page")," object between multiple tests, you can create your own in the ",(0,r.kt)("a",{parentName:"p",href:"/docs/1.14/api/class-test#test-before-all"},"test.beforeAll(hookFunction)")," and close it in ",(0,r.kt)("a",{parentName:"p",href:"/docs/1.14/api/class-test#test-after-all"},"test.afterAll(hookFunction)"),"."),(0,r.kt)(l.Z,{groupId:"js-flavor",defaultValue:"ts",values:[{label:"TypeScript",value:"ts"},{label:"JavaScript",value:"js"}],mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"ts",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// example.spec.ts\n\nimport { test, Page } from '@playwright/test';\n\ntest.describe.serial('use the same page', () => {\n  let page: Page;\n\n  test.beforeAll(async ({ browser }) => {\n    page = await browser.newPage();\n  });\n\n  test.afterAll(async () => {\n    await page.close();\n  });\n\n  test('runs first', async () => {\n    await page.goto('https://playwright.dev/');\n  });\n\n  test('runs second', async () => {\n    await page.click('text=Get Started');\n  });\n});\n"))),(0,r.kt)(i.Z,{value:"js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// example.spec.js\n// @ts-check\n\nconst { test } = require('@playwright/test');\n\ntest.describe.serial('use the same page', () => {\n  /** @type {import('@playwright/test').Page} */\n  let page;\n\n  test.beforeAll(async ({ browser }) => {\n    page = await browser.newPage();\n  });\n\n  test.afterAll(async () => {\n    await page.close();\n  });\n\n  test('runs first', async () => {\n    await page.goto('https://playwright.dev/');\n  });\n\n  test('runs second', async () => {\n    await page.click('text=Get Started');\n  });\n});\n")))),(0,r.kt)("h2",{id:"shard-tests-between-multiple-machines"},"Shard tests between multiple machines"),(0,r.kt)("p",null,"Playwright Test can shard a test suite, so that it can be executed on multiple machines. For that,  pass ",(0,r.kt)("inlineCode",{parentName:"p"},"--shard=x/y")," to the command line. For example, to split the suite into three shards, each running one third of the tests:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npx playwright test --shard=1/3\nnpx playwright test --shard=2/3\nnpx playwright test --shard=3/3\n")),(0,r.kt)("p",null,"That way your test suite completes 3 times faster."),(0,r.kt)("h2",{id:"limit-failures-and-fail-fast"},"Limit failures and fail fast"),(0,r.kt)("p",null,"You can limit the number of failed tests in the whole test suite by setting ",(0,r.kt)("inlineCode",{parentName:"p"},"maxFailures")," config option or passing ",(0,r.kt)("inlineCode",{parentName:"p"},"--max-failures")," command line flag."),(0,r.kt)("p",null,'When running with "max failures" set, Playwright Test will stop after reaching this number of failed tests and skip any tests that were not executed yet. This is useful to avoid wasting resources on broken test suites.'),(0,r.kt)("p",null,"Passing command line option:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npx playwright test --max-failures=10\n")),(0,r.kt)("p",null,"Setting in the configuration file:"),(0,r.kt)(l.Z,{groupId:"js-flavor",defaultValue:"ts",values:[{label:"TypeScript",value:"ts"},{label:"JavaScript",value:"js"}],mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"ts",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// playwright.config.ts\nimport { PlaywrightTestConfig } from '@playwright/test';\n\nconst config: PlaywrightTestConfig = {\n  // Limit the number of failures on CI to save resources\n  maxFailures: process.env.CI ? 10 : undefined,\n};\nexport default config;\n"))),(0,r.kt)(i.Z,{value:"js",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// playwright.config.js\n// @ts-check\n\n/** @type {import('@playwright/test').PlaywrightTestConfig} */\nconst config = {\n  // Limit the number of failures on CI to save resources\n  maxFailures: process.env.CI ? 10 : undefined,\n};\n\nmodule.exports = config;\n")))),(0,r.kt)("h2",{id:"worker-index"},"Worker index"),(0,r.kt)("p",null,"Each worker process is assigned a unique id (an index that starts with 1). You can read it from environment variable ",(0,r.kt)("inlineCode",{parentName:"p"},"process.env.TEST_WORKER_INDEX"),", or access through ",(0,r.kt)("a",{parentName:"p",href:"/docs/1.14/api/class-testinfo#test-info-worker-index"},"testInfo.workerIndex"),"."))}k.isMDXComponent=!0}}]);