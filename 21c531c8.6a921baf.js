(window.webpackJsonp=window.webpackJsonp||[]).push([[97],{168:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return c})),n.d(t,"toc",(function(){return b})),n.d(t,"default",(function(){return l}));var a=n(3),r=n(7),i=(n(0),n(819)),o={id:"ci",title:"Continuous Integration"},c={unversionedId:"ci",id:"version-1.1.0/ci",isDocsHomePage:!1,title:"Continuous Integration",description:"Playwright tests can be executed to run on your CI environments. To simplify this, we have created sample configurations for common CI providers that can be used to bootstrap your setup.",source:"@site/versioned_docs/version-1.1.0/ci.mdx",slug:"/ci",permalink:"/docs/1.1.0/ci",version:"1.1.0",sidebar:"version-1.1.0/docs",previous:{title:"Navigation and loading",permalink:"/docs/1.1.0/loading"},next:{title:"Test Runners",permalink:"/docs/1.1.0/test-runners"}},b=[{value:"CI configurations",id:"ci-configurations",children:[{value:"GitHub Actions",id:"github-actions",children:[]},{value:"Docker",id:"docker",children:[]},{value:"Azure Pipelines",id:"azure-pipelines",children:[]}]},{value:"Caching browsers",id:"caching-browsers",children:[]},{value:"Debugging browser launches",id:"debugging-browser-launches",children:[]}],s={toc:b};function l(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"Playwright tests can be executed to run on your CI environments. To simplify this, we have created sample configurations for common CI providers that can be used to bootstrap your setup."),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"#ci-configurations"}),"CI configurations"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"#github-actions"}),"GitHub Actions")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"#docker"}),"Docker")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"#azure-pipelines"}),"Azure Pipelines")))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"#caching-browsers"}),"Caching browsers"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"#exception-nodemodules-are-cached"}),"Exception: ",Object(i.b)("inlineCode",{parentName:"a"},"node_modules")," are cached")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"#directories-to-cache"}),"Directories to cache")))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"#debugging-browser-launches"}),"Debugging browser launches"))),Object(i.b)("p",null,"Broadly, configuration on CI involves ",Object(i.b)("strong",{parentName:"p"},"ensuring system dependencies")," are in place, ",Object(i.b)("strong",{parentName:"p"},"installing Playwright and browsers")," (typically with ",Object(i.b)("inlineCode",{parentName:"p"},"npm install"),"), and ",Object(i.b)("strong",{parentName:"p"},"running tests")," (typically with ",Object(i.b)("inlineCode",{parentName:"p"},"npm test"),"). Windows and macOS build agents do not require any additional system dependencies. Linux build agents can require additional dependencies, depending on the Linux distribution."),Object(i.b)("h2",{id:"ci-configurations"},"CI configurations"),Object(i.b)("h3",{id:"github-actions"},"GitHub Actions"),Object(i.b)("p",null,"The ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/microsoft/playwright-github-action"}),"Playwright GitHub Action")," can be used to run Playwright tests on GitHub Actions."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yml"}),"steps:\n  - uses: microsoft/playwright-github-action@v1\n  - name: Run your tests\n    run: npm test\n")),Object(i.b)("p",null,"We run ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/microsoft/playwright/blob/master/.github/workflows/tests.yml"}),"our tests")," on GitHub Actions, across a matrix of 3 platforms (Windows, Linux, macOS) and 3 browsers (Chromium, Firefox, WebKit)."),Object(i.b)("h3",{id:"docker"},"Docker"),Object(i.b)("p",null,"We have a ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/1.1.0/docker/README"}),"pre-built Docker image")," which can either be used directly, or as a reference to update your existing Docker definitions."),Object(i.b)("p",null,"Suggested configuration"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"By default, Docker runs a container with a ",Object(i.b)("inlineCode",{parentName:"p"},"/dev/shm")," shared memory space 64MB.\nThis is ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/c0b/chrome-in-docker/issues/1"}),"typically too small")," for Chromium\nand will cause Chromium to crash when rendering large pages. To fix, run the container with\n",Object(i.b)("inlineCode",{parentName:"p"},"docker run --shm-size=1gb")," to increase the size of ",Object(i.b)("inlineCode",{parentName:"p"},"/dev/shm"),". Since Chromium 65, this is no\nlonger necessary. Instead, launch the browser with the ",Object(i.b)("inlineCode",{parentName:"p"},"--disable-dev-shm-usage")," flag:"),Object(i.b)("pre",{parentName:"li"},Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-js"}),"const browser = await playwright.chromium.launch({\n  args: ['--disable-dev-shm-usage']\n});\n")),Object(i.b)("p",{parentName:"li"},"This will write shared memory files into ",Object(i.b)("inlineCode",{parentName:"p"},"/tmp")," instead of ",Object(i.b)("inlineCode",{parentName:"p"},"/dev/shm"),". See\n",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://bugs.chromium.org/p/chromium/issues/detail?id=736452"}),"crbug.com/736452")," for more details.")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Using ",Object(i.b)("inlineCode",{parentName:"p"},"--ipc=host")," is also recommended when using Chromium\u2014without it Chromium can run out of memory\nand crash. Learn more about this option in ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.docker.com/engine/reference/run/#ipc-settings---ipc"}),"Docker docs"),".")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Seeing other weird errors when launching Chromium? Try running your container\nwith ",Object(i.b)("inlineCode",{parentName:"p"},"docker run --cap-add=SYS_ADMIN")," when developing locally. Since the Dockerfile\nadds a ",Object(i.b)("inlineCode",{parentName:"p"},"pwuser")," user as a non-privileged user, it may not have all the necessary privileges.")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/Yelp/dumb-init"}),"dumb-init")," is worth checking out if you're\nexperiencing a lot of zombies Chromium processes sticking around. There's special\ntreatment for processes with PID=1, which makes it hard to terminate Chromium\nproperly in some cases (e.g. in Docker)."))),Object(i.b)("h3",{id:"azure-pipelines"},"Azure Pipelines"),Object(i.b)("p",null,"For Windows or macOS agents, no additional configuration required, just install Playwright and run your tests."),Object(i.b)("p",null,"For Linux agents, refer to ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/1.1.0/docker/README"}),"our Docker setup")," to see additional dependencies that need to be installed."),Object(i.b)("h2",{id:"caching-browsers"},"Caching browsers"),Object(i.b)("p",null,"By default, Playwright downloads browser binaries when the Playwright NPM package\nis installed. The NPM packages have a ",Object(i.b)("inlineCode",{parentName:"p"},"postinstall")," hook that downloads the browser\nbinaries. This behavior can be ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/1.1.0/installation"}),"customized with environment variables"),"."),Object(i.b)("p",null,"Caching browsers on CI is ",Object(i.b)("strong",{parentName:"p"},"strictly optional"),": The ",Object(i.b)("inlineCode",{parentName:"p"},"postinstall")," hooks should\nexecute and download the browser binaries on every run."),Object(i.b)("h4",{id:"exception-node_modules-are-cached"},"Exception: ",Object(i.b)("inlineCode",{parentName:"h4"},"node_modules")," are cached"),Object(i.b)("p",null,"Most CI providers cache the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.npmjs.com/cli-commands/cache.html"}),"npm-cache"),"\ndirectory (located at ",Object(i.b)("inlineCode",{parentName:"p"},"$HOME/.npm"),"). If your CI pipelines caches the ",Object(i.b)("inlineCode",{parentName:"p"},"node_modules"),"\ndirectory and you run ",Object(i.b)("inlineCode",{parentName:"p"},"npm install")," (instead of ",Object(i.b)("inlineCode",{parentName:"p"},"npm ci"),"), the default configuration\n",Object(i.b)("strong",{parentName:"p"},"will not work"),". This is because the ",Object(i.b)("inlineCode",{parentName:"p"},"npm install")," step will find the NPM\npackage on disk, and not execute the ",Object(i.b)("inlineCode",{parentName:"p"},"postinstall")," step."),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"Travis CI automatically caches ",Object(i.b)("inlineCode",{parentName:"p"},"node_modules")," if your repo does not have a\n",Object(i.b)("inlineCode",{parentName:"p"},"package-lock.json")," file.")),Object(i.b)("p",null,"This behavior can be fixed with one of the following approaches:"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Move to caching ",Object(i.b)("inlineCode",{parentName:"li"},"$HOME/.npm")," or the npm-cache directory. (This is the default\nbehavior in most CI providers.)"),Object(i.b)("li",{parentName:"ol"},"Set ",Object(i.b)("inlineCode",{parentName:"li"},"PLAYWRIGHT_BROWSERS_PATH=0")," as the environment variable before running\n",Object(i.b)("inlineCode",{parentName:"li"},"npm install"),". This will download the browser binaries in the ",Object(i.b)("inlineCode",{parentName:"li"},"node_modules"),"\ndirectory and cache them with the package code. See ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"/docs/1.1.0/installation"}),"installation docs"),"."),Object(i.b)("li",{parentName:"ol"},"Cache the browser binaries, with the steps below.")),Object(i.b)("h4",{id:"directories-to-cache"},"Directories to cache"),Object(i.b)("p",null,"With the default behavior, Playwright downloads the browser binaries in the following\ndirectories:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"%USERPROFILE%\\AppData\\Local\\ms-playwright")," on Windows"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"~/Library/Caches/ms-playwright")," on MacOS"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"~/.cache/ms-playwright")," on Linux")),Object(i.b)("p",null,"To cache the browser downloads between CI runs, cache this location in your CI\nconfiguration, against a hash of the Playwright version."),Object(i.b)("h2",{id:"debugging-browser-launches"},"Debugging browser launches"),Object(i.b)("p",null,"Playwright supports the ",Object(i.b)("inlineCode",{parentName:"p"},"DEBUG")," environment variable to output debug logs during execution. Setting it to ",Object(i.b)("inlineCode",{parentName:"p"},"pw:browser*")," is helpful while debugging ",Object(i.b)("inlineCode",{parentName:"p"},"Error: Failed to launch browser")," errors."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"DEBUG=pw:browser* npm run test\n")))}l.isMDXComponent=!0},819:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=r.a.createContext({}),l=function(e){var t=r.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=l(e.components);return r.a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,s=b(e,["components","mdxType","originalType","parentName"]),p=l(n),d=a,m=p["".concat(o,".").concat(d)]||p[d]||u[d]||i;return n?r.a.createElement(m,c(c({ref:t},s),{},{components:n})):r.a.createElement(m,c({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var c={};for(var b in t)hasOwnProperty.call(t,b)&&(c[b]=t[b]);c.originalType=e,c.mdxType="string"==typeof e?e:a,o[1]=c;for(var s=2;s<i;s++)o[s]=n[s];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);