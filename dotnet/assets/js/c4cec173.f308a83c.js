(self.webpackChunkplaywright_dev=self.webpackChunkplaywright_dev||[]).push([[6579],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return u},kt:function(){return c}});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=r.createContext({}),p=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=p(e.components);return r.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=p(n),c=i,f=m["".concat(s,".").concat(c)]||m[c]||d[c]||a;return n?r.createElement(f,o(o({ref:t},u),{},{components:n})):r.createElement(f,o({ref:t},u))}));function c(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var p=2;p<a;p++)o[p]=n[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},8215:function(e,t,n){"use strict";n(7294)},1395:function(e,t,n){"use strict";n(7294),n(944)},9443:function(e,t,n){"use strict";var r=(0,n(7294).createContext)(void 0);t.Z=r},944:function(e,t,n){"use strict";var r=n(7294),i=n(9443);t.Z=function(){var e=(0,r.useContext)(i.Z);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},5723:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return o},metadata:function(){return l},toc:function(){return s},default:function(){return u}});var r=n(2122),i=n(9756),a=(n(7294),n(3905)),o=(n(1395),n(8215),{id:"test-advanced",title:"Advanced: configuration"}),l={unversionedId:"test-advanced",id:"test-advanced",isDocsHomePage:!1,title:"Advanced: configuration",description:"- Project configuration",source:"@site/docs/test-advanced.mdx",sourceDirName:".",slug:"/test-advanced",permalink:"/dotnet/docs/test-advanced",version:"current",frontMatter:{id:"test-advanced",title:"Advanced: configuration"}},s=[{value:"Project configuration",id:"project-configuration",children:[]},{value:"Test run options",id:"test-run-options",children:[]},{value:"Projects",id:"projects",children:[]},{value:"workerInfo object",id:"workerinfo-object",children:[]},{value:"testInfo object",id:"testinfo-object",children:[]},{value:"Global setup and teardown",id:"global-setup-and-teardown",children:[]},{value:"Fixture options",id:"fixture-options",children:[{value:"Add custom matchers using expect.extend",id:"add-custom-matchers-using-expectextend",children:[]}]}],p={toc:s};function u(e){var t=e.components,n=(0,i.Z)(e,["components"]);return(0,a.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#project-configuration"},"Project configuration")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#test-run-options"},"Test run options")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#projects"},"Projects")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#workerinfo-object"},"workerInfo object")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#testinfo-object"},"testInfo object")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#global-setup-and-teardown"},"Global setup and teardown")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#fixture-options"},"Fixture options"))),(0,a.kt)("h2",{id:"project-configuration"},"Project configuration"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"metadata: any")," - Any JSON-serializable metadata that will be put directly to the test report."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"name: string")," - Project name, useful when defining multiple ",(0,a.kt)("a",{parentName:"li",href:"#projects"},"test projects"),"."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"outputDir: string")," - Output directory for files created during the test run."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"repeatEach: number")," - The number of times to repeat each test, useful for debugging flaky tests. Overridden by ",(0,a.kt)("inlineCode",{parentName:"li"},"--repeat-each")," command line option."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"retries: number")," - The maximum number of retry attempts given to failed tests. Overridden by ",(0,a.kt)("inlineCode",{parentName:"li"},"--retries")," command line option."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"screenshot: 'off' | 'on' | 'only-on-failure'")," - Whether to capture a screenshot after each test, off by default.",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"off")," - Do not capture screenshots."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"on")," - Capture screenshot after each test."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"only-on-failure")," - Capture screenshot after each test failure."))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"snapshotDir: string")," - ",(0,a.kt)("a",{parentName:"li",href:"#snapshots"},"Snapshots")," directory. Overridden by ",(0,a.kt)("inlineCode",{parentName:"li"},"--snapshot-dir")," command line option."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"testDir: string")," - Directory that will be recursively scanned for test files."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"testIgnore: string | RegExp | (string | RegExp)[]")," - Files matching one of these patterns are not considered test files."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"testMatch: string | RegExp | (string | RegExp)[]")," - Only the files matching one of these patterns are considered test files."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"timeout: number")," - Timeout for each test in milliseconds. Overridden by ",(0,a.kt)("inlineCode",{parentName:"li"},"--timeout")," command line option."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"video: 'off' | 'on' | 'retain-on-failure' | 'retry-with-video'")," - Whether to record video for each test, off by default.",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"off")," - Do not record video."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"on")," - Record video for each test."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"retain-on-failure"),"  - Record video for each test, but remove all videos from successful test runs."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"retry-with-video")," - Record video only when retrying a test.")))),(0,a.kt)("h2",{id:"test-run-options"},"Test run options"),(0,a.kt)("p",null,"These options would be typically different between local development and CI operation:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"forbidOnly: boolean")," - Whether to exit with an error if any tests are marked as ",(0,a.kt)("inlineCode",{parentName:"li"},"test.only"),". Useful on CI. Overridden by ",(0,a.kt)("inlineCode",{parentName:"li"},"--forbid-only")," command line option."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"globalSetup: string")," - Path to the global setup file. This file will be required and run before all the tests. It must export a single function."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"globalTeardown: string")," - Path to the global teardown file. This file will be required and run after all the tests. It must export a single function."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"globalTimeout: number")," - Total timeout in milliseconds for the whole test run. Overridden by ",(0,a.kt)("inlineCode",{parentName:"li"},"--global-timeout")," command line option."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"grep: RegExp | RegExp[]")," - Patterns to filter tests based on their title. Overridden by ",(0,a.kt)("inlineCode",{parentName:"li"},"--grep")," command line option."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"maxFailures: number")," - The maximum number of test failures for this test run. After reaching this number, testing will stop and exit with an error. Setting to zero (default) disables this behavior. Overridden by ",(0,a.kt)("inlineCode",{parentName:"li"},"--max-failures")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"-x")," command line options."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"preserveOutput: 'always' | 'never' | 'failures-only'")," - Whether to preserve test output in the ",(0,a.kt)("inlineCode",{parentName:"li"},"outputDir"),":",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"'always'")," - preserve output for all tests;"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"'never'")," - do not preserve output for any tests;"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"'failures-only'")," - only preserve output for failed tests."))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"projects: Project[]")," - Multiple ",(0,a.kt)("a",{parentName:"li",href:"#projects"},"projects")," configuration."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"reporter: 'list' | 'line' | 'dot' | 'json' | 'junit'")," - The reporter to use. See ",(0,a.kt)("a",{parentName:"li",href:"#reporters"},"reporters")," for details."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"quiet: boolean")," - Whether to suppress stdout and stderr from the tests. Overridden by ",(0,a.kt)("inlineCode",{parentName:"li"},"--quiet")," command line option."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"shard: { total: number, current: number } | null")," - ",(0,a.kt)("a",{parentName:"li",href:"#shards"},"Shard")," information. Overridden by ",(0,a.kt)("inlineCode",{parentName:"li"},"--shard")," command line option."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"updateSnapshots: boolean")," - Whether to update expected snapshots with the actual results produced by the test run. Overridden by ",(0,a.kt)("inlineCode",{parentName:"li"},"--update-snapshots")," command line option."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"workers: number")," - The maximum number of concurrent worker processes to use for parallelizing tests. Overridden by ",(0,a.kt)("inlineCode",{parentName:"li"},"--workers")," command line option.")),(0,a.kt)("h2",{id:"projects"},"Projects"),(0,a.kt)("p",null,"Playwright Test supports running multiple test projects at the same time. This is useful for running the same tests in multiple configurations. For example, consider running tests against multiple versions of the database."),(0,a.kt)("p",null,'To make use of this feature, we will declare an "option fixture" for the database version, and use it in the tests.'),(0,a.kt)("p",null,"We can use our fixtures in the test."),(0,a.kt)("p",null,"Now, we can run test in multiple configurations by using projects."),(0,a.kt)("p",null,"Each project can be configured separately, and run different set of tests with different parameters. Supported options are ",(0,a.kt)("inlineCode",{parentName:"p"},"name"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"outputDir"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"repeatEach"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"retries"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"snapshotDir"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"testDir"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"testIgnore"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"testMatch")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"timeout"),". See ",(0,a.kt)("a",{parentName:"p",href:"#configuration-object"},"configuration object")," for detailed description."),(0,a.kt)("p",null,"You can run all projects or just a single one:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# Run both projects - each test will be run twice\nnpx playwright test\n\n# Run a single project - each test will be run once\nnpx playwright test --project=v2\n")),(0,a.kt)("h2",{id:"workerinfo-object"},"workerInfo object"),(0,a.kt)("p",null,"Depending on the configuration and failures, Playwright Test might use different number of worker processes to run all the tests. For example, Playwright Test will always start a new worker process after a failing test."),(0,a.kt)("p",null,"Worker-scoped fixtures and ",(0,a.kt)("inlineCode",{parentName:"p"},"beforeAll")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"afterAll")," hooks receive ",(0,a.kt)("inlineCode",{parentName:"p"},"workerInfo")," parameter. The following information is accessible from the ",(0,a.kt)("inlineCode",{parentName:"p"},"workerInfo"),":"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"config")," - ",(0,a.kt)("a",{parentName:"li",href:"#configuration-object"},"Configuration object"),"."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"project")," - Specific ",(0,a.kt)("a",{parentName:"li",href:"#projects"},"project")," configuration for this worker. Different projects are always run in separate processes."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"workerIndex: number")," - A unique sequential index assigned to the worker process.")),(0,a.kt)("p",null,"Consider an example where we run a new http server per worker process, and use ",(0,a.kt)("inlineCode",{parentName:"p"},"workerIndex")," to produce a unique port number:"),(0,a.kt)("h2",{id:"testinfo-object"},"testInfo object"),(0,a.kt)("p",null,"Test fixtures and ",(0,a.kt)("inlineCode",{parentName:"p"},"beforeEach")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"afterEach")," hooks receive ",(0,a.kt)("inlineCode",{parentName:"p"},"testInfo")," parameter. It is also available to the test function as a second parameter."),(0,a.kt)("p",null,"In addition to everything from the ",(0,a.kt)("a",{parentName:"p",href:"#workerinfo"},(0,a.kt)("inlineCode",{parentName:"a"},"workerInfo")),", the following information is accessible before and during the test:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"title: string")," - Test title."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"file: string")," - Full path to the test file."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"line: number")," - Line number of the test declaration."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"column: number")," - Column number of the test declaration."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"fn: Function")," - Test body function."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"repeatEachIndex: number")," - The sequential repeat index."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"retry: number")," - The sequential number of the test retry (zero means first run)."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"expectedStatus: 'passed' | 'failed' | 'timedOut'")," - Whether this test is expected to pass, fail or timeout."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"timeout: number")," - Test timeout."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"annotations")," - ",(0,a.kt)("a",{parentName:"li",href:"#annotations"},"Annotations")," that were added to the test."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"snapshotPathSegment: string")," - Relative path, used to locate snapshots for the test."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"snapshotPath(...pathSegments: string[])")," - Function that returns the full path to a particular snapshot for the test."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"outputDir: string")," - Absolute path to the output directory for this test run."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"outputPath(...pathSegments: string[])")," - Function that returns the full path to a particular output artifact for the test.")),(0,a.kt)("p",null,"The following information is accessible after the test body has finished, in fixture teardown:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"duration: number")," - test running time in milliseconds."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"status: 'passed' | 'failed' | 'timedOut'")," - the actual test result."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"error")," - any error thrown by the test body."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"stdout: (string | Buffer)[]")," - array of stdout chunks collected during the test run."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"stderr: (string | Buffer)[]")," - array of stderr chunks collected during the test run.")),(0,a.kt)("p",null,"Here is an example test that saves some information:"),(0,a.kt)("p",null,"Here is an example fixture that automatically saves debug logs when the test fails:"),(0,a.kt)("h2",{id:"global-setup-and-teardown"},"Global setup and teardown"),(0,a.kt)("p",null,"To set something up once before running all tests, use ",(0,a.kt)("inlineCode",{parentName:"p"},"globalSetup")," option in the ",(0,a.kt)("a",{parentName:"p",href:"#writing-a-configuration-file"},"configuration file"),". Similarly, use ",(0,a.kt)("inlineCode",{parentName:"p"},"globalTeardown")," to run something once after all the tests."),(0,a.kt)("h2",{id:"fixture-options"},"Fixture options"),(0,a.kt)("p",null,"It is common for the ",(0,a.kt)("a",{parentName:"p",href:"#fixtures"},"fixtures"),' to be configurable, based on various test needs. Playwright Test allows creating "options" fixture for this purpose.'),(0,a.kt)("p",null,"We can now pass the option value with ",(0,a.kt)("inlineCode",{parentName:"p"},"test.use()"),"."),(0,a.kt)("p",null,"In addition to ",(0,a.kt)("inlineCode",{parentName:"p"},"test.use()"),", we can also specify options in the configuration file."),(0,a.kt)("h3",{id:"add-custom-matchers-using-expectextend"},"Add custom matchers using expect.extend"),(0,a.kt)("p",null,"Playwright Test uses ",(0,a.kt)("a",{parentName:"p",href:"https://jestjs.io/docs/expect"},"expect")," under the hood which has the functionality to extend it with ",(0,a.kt)("a",{parentName:"p",href:"https://jestjs.io/docs/expect#expectextendmatchers"},"custom matchers"),". See the following example where a custom ",(0,a.kt)("inlineCode",{parentName:"p"},"toBeWithinRange")," function gets added."),(0,a.kt)("p",null,"To import expect matching libraries like ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/jest-community/jest-extended#installation"},"jest-extended")," you can import it from your ",(0,a.kt)("inlineCode",{parentName:"p"},"globals.d.ts"),":"))}u.isMDXComponent=!0}}]);